# ooder平台最佳实践

## 目录

1. [设计原则](#1-设计原则)
   - 1.1 核心设计原则
   - 1.2 组件设计原则
2. [实现规范](#2-实现规范)
   - 2.1 注解使用规范
   - 2.2 服务设计规范
   - 2.3 参数设计规范
   - 2.4 异常处理规范
3. [性能优化](#3-性能优化)
   - 3.1 组件优化
   - 3.2 通讯优化
   - 3.3 缓存机制
   - 3.4 异步处理
4. [核心理念实践](#4-核心理念实践)
   - 4.1 视图对象的双重角色
   - 4.2 注解驱动的设计原则
5. [服务架构实践](#5-服务架构实践)
   - 5.1 通用服务注解规范
   - 5.2 服务类型定义
   - 5.3 服务参数设计规范
6. [Page机制实践](#6-page机制实践)
   - 6.1 Page设计原则
   - 6.2 Page实现规范
   - 6.3 Page事件处理
7. [注意事项](#7-注意事项)

## 1. 设计原则

### 1.1 核心设计原则

1. **单一职责原则**：每个组件应有明确的职责和用途
2. **可复用性原则**：设计通用组件，提高代码复用率
3. **可维护性原则**：保持代码结构清晰，易于理解和修改
4. **可扩展性原则**：提供扩展机制，支持自定义组件的开发和集成

### 1.2 组件设计原则

1. **组件化设计思想**：将复杂功能拆分为可复用的组件模块，通过组合不同组件实现复杂业务场景
2. **前后端分离**：通过注解实现前后端的强类型映射，确保数据传输的一致性和完整性
3. **容器组件与展示组件分离**：前端设计采用容器组件和展示组件分离的主键策略

## 2. 实现规范

### 2.1 注解使用规范

1. **正确使用各类注解**：根据功能需求选择合适的注解类型
2. **注解分类使用**：
   - 视图层注解：用于定义组件的外观和布局
   - 行为注解：用于定义组件的事件和交互行为
   - 字段注解：用于定义具体的数据项和输入控件
   - 服务注解：用于定义服务类和方法的Web访问性
3. **注解组合规范**：
   - 遵循注解使用的去重原则，避免重复配置
   - 合理组合不同类型的注解以实现完整的组件定义
4. **注解配置规范**：
   - 遵循最小化配置原则，只配置必要的属性
   - 保持注解配置的一致性和可读性

### 2.2 服务设计规范

1. **Web可访问性**：所有服务必须采用Spring MVC注解，确保服务可以通过HTTP协议进行访问
2. **服务类型声明**：使用@Aggregation注解声明服务类型
3. **返回数据**：统一使用ResultModel或ListResultModel标准返回类型
4. **视图与服务分离**：保持职责清晰

### 2.3 参数设计规范

1. **参数最小化原则**：只传递必要的参数，减少数据传输量
2. **参数一致性原则**：保持参数命名和类型的统一
3. **参数可读性原则**：参数命名应清晰表达其用途
4. **参数使用场景**：
   - 简单参数使用场景：重置操作、刷新操作、根据主键查询、状态更新操作
   - 复杂视图对象参数使用场景：表单提交操作、复杂查询操作、批量操作

### 2.4 异常处理规范

1. **统一异常处理机制**：提供完善的异常处理机制
2. **异常信息友好**：提供清晰的错误提示信息
3. **异常分类处理**：根据异常类型采取不同的处理策略

## 3. 性能优化

### 3.1 组件优化

1. **合理设计组件结构**：避免过度嵌套，提高组件渲染效率
2. **组件复用**：设计通用组件，提高代码复用率

### 3.2 通讯优化

1. **优化通讯协议**：减少数据传输量，提高通讯效率
2. **合理使用遮罩**：在数据加载时提供良好的用户体验

### 3.3 缓存机制

1. **合理使用缓存机制**：提高响应速度，减少重复请求
2. **缓存策略**：根据数据特性选择合适的缓存策略

### 3.4 异步处理

1. **采用异步处理**：提高系统并发能力
2. **事件链条处理**：合理处理事件链条，避免阻塞

## 4. 核心理念实践

### 4.1 视图对象的双重角色

1. **数据传输对象(DTO)**：视图对象作为数据载体，用于前后端数据传输
2. **视图配置载体**：通过注解定义视图的外观、行为和交互

### 4.2 注解驱动的设计原则

1. **声明式配置**：通过注解声明视图结构和行为，而非编程式定义
2. **配置即代码**：注解配置与业务逻辑分离，提高可维护性
3. **强类型映射**：注解与前端组件一一对应，确保类型安全

### 4.3 前后端强映射关系

1. **组件映射**：ComponentType.INPUT → ood.UI.Input
2. **视图映射**：ViewType.FORM → 表单视图
3. **事件映射**：APIEventAnnotation → 绑定前端事件与后端服务
4. **数据流向**：RequestPathEnum/ResponsePathEnum → 控制前后端数据流向

## 5. 服务架构实践

### 5.1 通用服务注解规范

1. **Spring MVC注解**：所有通用服务必须采用Spring MVC注解
2. **@Aggregation注解**：使用@Aggregation注解声明服务类型

### 5.2 服务类型定义

1. **BAR服务**：处理工具栏和底部栏操作，声明为AggregationType.MENU
2. **通用视图服务**：处理视图业务逻辑，声明为AggregationType.API
3. **服务入口服务**：模块主入口点，应作为普通Web服务实现
4. **导航服务**：处理视图间跳转，声明为MENU类型
5. **模块跳转服务**：应使用@ModuleAnnotation进行配置

### 5.3 服务参数设计规范

1. **简单参数使用场景**：重置操作、刷新操作、根据主键查询、状态更新操作
2. **复杂视图对象参数使用场景**：表单提交操作、复杂查询操作、批量操作
3. **参数设计原则**：最小化原则、一致性原则、可读性原则、性能原则

## 6. Page机制实践

### 6.1 Page设计原则

1. **单一职责原则**：每个Page应有明确的业务职责，避免功能过于复杂
2. **高内聚低耦合**：Page内部组件高内聚，Page间低耦合
3. **可复用性**：设计可复用的Page模板和组件

**Page设计实例：**

```java
// 主控制台视图入口
@RestController
@RequestMapping("/dashboard")
public class MainDashboardViewController {
    // 视图入口方法具有Web可访问性
    @GetMapping
    public MainDashboardView getMainDashboardView() {
        // 返回视图对象，Web容器自动包装为Page
        return new MainDashboardView();
    }
}

public class MainDashboardView {
    // 包含多个子页面的导航入口
    private List<ViewNavigation> subViews;
    
    // 主要内容区域
    private MainContentView mainContent;
}
```

在上述示例中，[MainDashboardView](file:///E:/ooder-gitee/ooder-annotation/src/main/java/net/ooder/attendance/view/AttendancePortalView.java#L30-L86)作为主控制台页面，具有明确的业务职责，即展示系统仪表板。它通过导航入口链接到其他子页面，实现了高内聚低耦合的设计原则。

### 6.2 Page实现规范

1. **注解使用规范**：正确使用Page相关注解
2. **数据一致性**：确保Page内各组件数据的一致性
3. **性能优化**：合理使用懒加载和缓存机制
4. **API设计规范**：确保所有服务方法都具有Web可访问性并声明@Aggregation注解

**Page实现实例：**

```java
// 视图类使用专用注解定义
@FormViewAnnotation(
    title = "用户管理",
    description = "用户信息管理页面"
)
public class UserManagementView {
    // 视图内容定义
}

// 服务类使用Spring注解确保Web可访问性
@Service
@RestController
@RequestMapping("/user/management")
public class UserManagementService {
    // 服务方法实现，并声明@Aggregation注解
    @GetMapping("/list")
    @Aggregation
    public ResultModel<List<User>> loadUsers() {
        // 加载用户列表
        return userRepository.findAll();
    }
}
```

在上述示例中，视图类使用了@FormViewAnnotation注解来定义页面的基本信息，服务类使用了@RestController和@Service注解确保Web可访问性，并在具体方法上使用了@Aggregation注解。

### 6.3 Page事件处理

1. **页面加载事件**：处理页面初始化时的数据加载和组件初始化
2. **视图切换事件**：处理页面内不同视图间的切换
3. **数据更新事件**：处理页面内数据的变化和更新

**Page事件处理实例：**

```java
// 订单管理视图入口
@RestController
@RequestMapping("/order/management")
public class OrderManagementViewController {
    @Autowired
    private OrderManagementPageService pageService;
    
    // 视图入口方法具有Web可访问性
    @GetMapping
    public OrderManagementView getOrderManagementView() {
        // 返回视图对象，Web容器自动包装为Page
        OrderManagementView view = new OrderManagementView();
        // 页面加载事件处理
        pageService.initializePage(view);
        return view;
    }
    
    @PostMapping("/view/change")
    public void onViewChange(@RequestParam String viewName) {
        // 视图切换事件处理
        pageService.handleViewChange(viewName);
    }
    
    @PostMapping("/data/update")
    public void onDataUpdate(@RequestBody Object data) {
        // 数据更新事件处理
        pageService.handleDataUpdate(data);
    }
}
```

在上述示例中，展示了Page的三种主要事件处理方式：
- 页面加载事件：在视图入口方法中调用`pageService.initializePage(view)`进行页面初始化
- 视图切换事件：通过`onViewChange`方法处理视图切换
- 数据更新事件：通过`onDataUpdate`方法处理数据更新

## 7. 注意事项

1. **避免在视图中混合使用不同类型的注解**：保持注解使用的一致性
2. **确保列表视图的单一性**：不得添加表单视图注解
3. **正确使用@Uid注解标识行主键**：确保数据标识的准确性
4. **合理配置模块跳转参数**：确保模块间跳转的正确性
5. **遵循fastjson序列化规范**：确保数据序列化的正确性
6. **所有BAR服务逻辑应在独立的服务类中实现**：保持代码结构清晰

## 8. 组件设计最佳实践

### 8.1 注解使用规范

1. **注解分类使用**：
   - 必须的注解：组件类型注解、视图类型注解、服务注解
   - 必要的修饰：外观注解、布局注解、数据注解
   - 增强的注解：行为注解、列表增强注解、复合注解

2. **注解组合原则**：
   - 遵循注解优先级规则，组件类型注解具有最高优先级
   - 合理组合不同类型的注解以实现完整的组件定义
   - 避免重复配置相同属性

3. **注解配置规范**：
   - 遵循最小化配置原则，只配置必要的属性
   - 保持注解配置的一致性和可读性
   - 合理使用默认值减少配置复杂度

### 8.2 组件设计原则

1. **单一职责原则**：每个组件应有明确的职责和用途
2. **可复用性原则**：设计通用组件，提高代码复用率
3. **可维护性原则**：保持代码结构清晰，易于理解和修改
4. **可扩展性原则**：提供扩展机制，支持自定义组件的开发和集成

### 8.3 业务转换思考

1. **从业务到代码的转换过程**：
   - 识别业务元素和用户需求
   - 选择合适的组件和交互方式
   - 定义组件属性和行为
   - 建立前后端映射关系
   - 实现服务逻辑

2. **代码设计规范**：
   - 字段命名应清晰表达业务含义
   - 遵循驼峰命名法
   - 合理分组相关字段
   - 提供充分的注释说明