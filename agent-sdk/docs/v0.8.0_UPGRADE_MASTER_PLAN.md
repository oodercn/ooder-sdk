# Ooder Platform v0.8.0 升级总计划

## 文档信息

| 项目 | 值 |
|------|-----|
| 版本 | v0.8.0 |
| 创建日期 | 2026-02-23 |
| 负责团队 | Ooder SDK Team + Engine Team |
| 关联项目 | [ooder-sdk](https://github.com/ooderCN/ooder-sdk) |
| 协议文档 | [v0.8.0 架构设计](https://github.com/ooderCN/skills/tree/main/docs/v0.8.0) |

---

# 第一部分：需求规格

## 一、版本概述

| 项目 | 值 |
|------|-----|
| 版本 | v0.8.0 |
| 架构代号 | CAP-Driven Architecture |
| 核心变更 | Scene=Agent、CAP标准化、能力驱动发现 |

### 1.1 设计目标

- **防止 Skills 膨胀**: 通过 CAP 标准化，避免重复开发
- **向后兼容**: CAP 版本化管理，保证驱动接口稳定
- **能力复用**: 同一 CAP 可被多个 Skill 实现，按需选择
- **AI 友好**: scene.md 和 cap.md 提供详细约束，AI 可理解扩展
- **离线优先**: 所有 CAP 必须支持离线降级实现

### 1.2 现有实现评估

| 模块 | 现有状态 | 复用度 | 升级方向 |
|------|----------|--------|----------|
| 发现机制 | 9种发现方法 | ✅ 100% | 无需修改 |
| Agent 体系 | McpAgent/RouteAgent/EndAgent | 🔄 60% | 新增 SceneAgent/WorkerAgent |
| 能力中心 | CapabilityCenter | 🔄 50% | 适配 CAP 地址空间 |
| 场景管理 | SceneManager | 🔄 40% | 增强 Workflow 编排 |
| 离线服务 | OfflineService | 🔄 50% | 增强降级策略 |
| 安全机制 | SecurityService | ✅ 80% | 小幅扩展 |

---

## 二、SDK 升级需求

### 2.1 核心协议实现 (P0)

#### 2.1.1 DiscoveryProtocol - 能力发现协议

**功能描述**: 实现多层级能力发现机制

| 接口方法 | 说明 | 优先级 |
|----------|------|--------|
| `syncAllIndexes()` | 同步 Scene/CAP/Skill 索引 | P0 |
| `listScenes(category)` | 获取场景列表 | P0 |
| `searchScenes(query)` | 搜索场景 | P0 |
| `getAvailableSkills(sceneId)` | 获取场景可用 Skills | P0 |

**发现方式支持**:

| 发现方式 | 适用场景 | 优先级 |
|----------|----------|--------|
| UDP Broadcast | 个人网络/部门分享 | P0 |
| mDNS/DNS-SD | 个人网络 | P1 |
| DHT (Kademlia) | 公司管理/公共社区 | P1 |
| SkillCenter API | 公司管理/公共社区 | P0 |
| Local FS | 离线缓存 | P0 |

#### 2.1.2 LoginProtocol - 本地认证协议

**功能描述**: 实现本地认证和设备入网安全

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 冷启动入网 | 设备首次启动认证流程 | P0 |
| 离线恢复入网 | 离线后重新入网 | P0 |
| 安全密钥管理 | 密钥分配和更新 | P0 |

#### 2.1.3 CollaborationProtocol - 场景组协作协议

**功能描述**: 实现多 Agent 协作

| 消息类型 | 格式 | 说明 |
|----------|------|------|
| AGENT_ANNOUNCE | `AGENT_ANNOUNCE:{agentId};{userId};{deviceName};{capabilities};{scenes};{status};{timestamp}` | Agent 启动广播 |
| CAP_SHARE | `CAP_SHARE:{agentId};{userId};{capId};{shareScope};{permissions};{expireTime};{timestamp}` | 能力分享广播 |
| SCENE_CREATE | `SCENE_CREATE:{agentId};{userId};{sceneId};{sceneName};{requiredCaps};{inviteList};{timestamp}` | 场景创建广播 |
| CAP_HANDOVER | `CAP_HANDOVER:{fromAgentId};{toAgentId};{capId};{reason};{timestamp}` | 能力转移请求 |
| CAP_SYNC_REQUEST | `CAP_SYNC_REQUEST:{fromAgentId};{toAgentId};{syncType};{timestamp}` | 能力同步请求 |

#### 2.1.4 OfflineService - 离线模式服务

**功能描述**: 保障离线可运行

| 策略 | 说明 | 适用场景 |
|------|------|----------|
| queue | 请求入队，恢复后同步 | 消息发送、任务提交 |
| cache | 缓存结果返回 | 查询类请求 |
| reject | 直接拒绝请求 | 实时性要求高 |
| custom | 自定义降级逻辑 | 特殊场景 |

**FallbackHandler 接口**:
```java
public interface FallbackHandler {
    <T> CompletableFuture<T> handle(CapRequest request, Class<T> responseType);
    void onReconnect();
    int getQueueSize();
}
```

### 2.2 基础设施实现 (P1)

#### 2.2.1 EventBus - 事件总线

**事件类型**:

| 事件类型 | 事件名称 | 说明 |
|----------|----------|------|
| 场景事件 | SceneActivatedEvent | 场景激活 |
| 场景事件 | SceneDeactivatedEvent | 场景停用 |
| 场景事件 | SceneSyncEvent | 场景同步 |
| Agent事件 | AgentJoinedEvent | Agent 加入 |
| Agent事件 | AgentLeftEvent | Agent 离开 |
| Agent事件 | AgentFailedEvent | Agent 故障 |
| CAP事件 | CapInvokedEvent | CAP 调用 |
| CAP事件 | CapFailedEvent | CAP 调用失败 |
| CAP事件 | CapFallbackEvent | CAP 降级触发 |

#### 2.2.2 数据模型扩展

**InstalledSkill 补充属性**:
```java
public class InstalledSkill {
    private String skillId;
    private String version;
    private List<String> implementedCaps;  // 实现的 CAP 列表
    private String connectorType;          // http/local-jar/grpc/websocket/udp
    private boolean offlineSupport;        // 是否支持离线
    private int priority;                  // 优先级
    private long installedTime;            // 安装时间
    private SkillStatus status;            // 状态
}
```

**LinkInfo 补充属性**:
```java
public class LinkInfo {
    private String linkId;                 // 唯一标识
    private String sourceCap;              // 源 CAP
    private String targetDevice;           // 目标设备
    private String targetCap;              // 目标 CAP
    private LinkStatus status;             // ACTIVE | SUSPENDED | FAILED
    private BindingType bindingType;       // STRONG | WEAK
}
```

**SceneGroupInfo 补充属性**:
```java
public class SceneGroupInfo {
    private String groupId;
    private String sceneId;
    private List<String> members;          // 成员 AgentId 列表
    private String leader;                 // 组长 AgentId
    private SceneGroupConfig config;
}
```

### 2.3 CAP 验证与调用机制

#### 2.3.1 契约验证

| 验证项 | 说明 |
|--------|------|
| 接口路径验证 | 检查是否实现了 CAP 定义的接口 |
| 请求格式验证 | 检查请求参数是否符合 schema |
| 响应格式验证 | 检查响应数据是否符合 schema |
| 降级实现验证 | 检查是否实现了 Fallback 方法 |
| 权限验证 | 检查是否声明了所需权限 |

#### 2.3.2 Command 执行机制

**Command 分类**:

| 类型 | 命名规范 | 示例 |
|------|----------|------|
| 标准命令 | `standard://{commandId}` | on, off, toggle, set, get |
| 自定义命令 | `custom://{namespace}/{commandId}` | custom://mycompany/special |

**执行流程**:
```
1. 绑定路径执行 → 发送 Command 到目标设备
2. 失败检测 → 查询链路状态，确认故障类型
3. 状态处理 → 离线/故障状态处理
```

### 2.4 心跳与状态管理

**设备分类心跳**:

| 设备类型 | 正常周期 | 休眠周期 | 离线判定 |
|----------|----------|----------|----------|
| 固定设备 (PC、NAS) | 30秒 | 无 | 连续3次丢失 |
| 移动设备 (手机) | 30秒 | 60秒 | 连续3次丢失 |
| 电池设备 (传感器) | 60秒 | 120秒 | 连续3次丢失 |

**状态定义**:

| 状态 | 说明 | 处理 |
|------|------|------|
| 在线 | 设备在线且可用 | 正常执行 |
| 离线 | 设备无响应 | 尝试重连 |
| 故障 | 有心跳但未响应命令 | 不再路由 |

---

## 三、Engine 升级需求

### 3.1 SceneAgent 核心实现

#### 3.1.1 Agent 属性定义

```java
public class SceneAgent {
    private String agentId;              // scene-{sceneName}-{uuid}
    private String sceneId;
    private AgentType type;              // PRIMARY | BACKUP | COLLABORATIVE
    private AgentStatus status;          // INITIALIZING | ACTIVE | SUSPENDED | STOPPED
    private SceneConfig config;
    private List<CapBinding> capBindings;
    private Map<String, Skill> skills;
    private SceneGroup group;
    private EventBus eventBus;
    private OfflineManager offlineManager;
}
```

#### 3.1.2 Agent 状态流转

```
INITIALIZING → ACTIVE ⇄ SUSPENDED → STOPPED → DESTROYED
```

### 3.2 初始化流程实现

```
1. 场景加载
   ├── 下载 scene.yaml 和 scene.md
   ├── 解析 agentConfig 配置
   └── 验证场景依赖

2. Agent 初始化
   ├── 创建 SceneAgent 实例
   ├── 分配 AgentID
   ├── 设置 Agent 角色
   └── 注册到 EventBus

3. CAP 解析
   ├── 读取 requiredCapabilities
   ├── 下载 cap.yaml 和 cap.md
   └── 验证 CAP 版本兼容性

4. Skill 发现与匹配
   ├── 查询 SkillCenter 已注册 Skills
   ├── 按 CAP 匹配 Skills
   └── 验证 Skill 契约合规性

5. Skill 挂载
   ├── 解析 CAP 调用类型
   ├── 创建 Skill 连接器
   └── 注册到 Agent 路由表

6. 场景激活
   ├── 启动 Skill 服务
   ├── 加入 SceneGroup
   └── 发布 SceneActivatedEvent
```

### 3.3 Skill 挂载机制

#### 3.3.1 调用类型支持

| 类型 | 说明 | 配置参数 |
|------|------|----------|
| http | HTTP/HTTPS 远程调用 | baseUrl, timeout, headers |
| local-jar | 本地 JAR 接口调用 | jarPath, mainClass |
| grpc | gRPC 远程调用 | endpoint, tls |
| websocket | WebSocket 双向通信 | endpoint, reconnect, heartbeat |
| udp | UDP 数据报 | host, port |

#### 3.3.2 Connector 接口

```java
public interface SkillConnector {
    CompletableFuture<Void> initialize(SkillConfig config);
    <T> CompletableFuture<T> invoke(CapRequest request, Class<T> responseType);
    boolean isConnected();
    void close();
}
```

### 3.4 CAP 路由管理

#### 3.4.1 路由表结构

```java
public class CapRoutingTable {
    private Map<String, List<SkillBinding>> capBindings;
    
    public SkillBinding getSkill(String capId);
    public void addBinding(String capId, SkillBinding binding);
    public void removeBinding(String capId, String skillId);
}
```

#### 3.4.2 路由策略

| 策略 | 说明 |
|------|------|
| priority | 按优先级选择 |
| round-robin | 轮询选择 |
| random | 随机选择 |
| least-load | 最小负载选择 |

### 3.5 WorkerAgent 设计

```java
public class WorkerAgent {
    private String workerId;            // worker-{sceneId}-{name}-{uuid}
    private String name;                // 显示名称
    private String sceneId;             // 所属场景
    private String skillId;             // 关联的 Skill
    private List<String> caps;          // 实现的 CAP 列表
    private AgentStatus status;         // IDLE | BUSY | ERROR
    private String preferredDevice;     // 首选设备
    private SkillConnector connector;
}
```

### 3.6 Workflow 编排

#### 3.6.1 Workflow 定义格式

```yaml
scene:
  id: "blog-publish"
  agents:
    - id: research-agent
      skill: skill-research
      caps: ["A0", "A1"]
      
  workflow:
    steps:
      - id: collect
        agent: research-agent
        cap: "A0"
        action: searchMaterials
        output: materials
        
      - id: write
        agent: writer-agent
        cap: "B0"
        dependsOn: [collect]
```

#### 3.6.2 WorkflowEngine 接口

```java
public class WorkflowEngine {
    public CompletableFuture<WorkflowResult> execute(String sceneId, WorkflowContext context);
    private boolean checkDependencies(WorkflowStep step, WorkflowContext context);
}
```

### 3.7 Provider 接口扩展

#### 3.7.1 新增 SEC 通用接口

| 接口 | 说明 | 版本 |
|------|------|------|
| NetworkConfigProvider | 网络配置管理 | 0.8.0 |
| DeviceManagementProvider | 设备管理 | 0.8.0 |
| SecurityConfigProvider | 安全配置管理 | 0.9.0 |
| HealthCheckProvider | 健康检查 | 0.9.0 |
| AgentProvider | Agent 管理 | 0.8.0 |
| SkillShareProvider | 技能分享 | 1.0.0 |

### 3.8 设备绑定管理

#### 3.8.1 绑定类型

| 类型 | 说明 | 处理 |
|------|------|------|
| 强绑定 | 不可拆分，只能故障设定 | 灯↔开关 |
| 弱绑定 | 用户可调整 | 场景↔设备 |

#### 3.8.2 故障处理流程

```
故障检测 → RouteAgent 上报 → McpAgent 标记 → 用户介入 → 处理选项
处理选项: 更换设备 / 移除设备 / 临时禁用
```

---

## 四、版本兼容策略

### 4.1 CAP 版本兼容

| 版本变更 | 兼容性 | 说明 |
|----------|--------|------|
| 1.0 → 1.1 | ✅ 兼容 | 新增可选字段 |
| 1.0 → 1.2 | ✅ 兼容 | 新增可选能力 |
| 1.0 → 2.0 | ❌ 不兼容 | 接口重构，需适配器 |

### 4.2 版本对应关系

| Skills版本 | SDK版本 | Engine版本 | 协议版本 |
|------------|---------|------------|----------|
| 0.7.x | 0.7.3 | 0.7.3 | v0.7.3 |
| 0.8.x | 0.8.0 | 0.8.0 | v0.8.0 |

---

# 第二部分：执行计划

## 五、SDK 任务分解

### 阶段一：核心架构升级（第1-4周）

#### 模块 A：CAP 注册表

**负责人**：`@待分配`  
**工作量**：10人天  
**优先级**：P0（最高）

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| CAP-001 | 创建 CAP 地址空间枚举（00-FF） | ⏳ 待开始 | - | - | - |
| CAP-002 | 实现 cap.yaml 解析器 | ⏳ 待开始 | - | - | - |
| CAP-003 | 实现 cap.md 文档加载器 | ⏳ 待开始 | - | - | - |
| CAP-004 | 实现 CapRegistry 接口和实现类 | ⏳ 待开始 | - | - | - |
| CAP-005 | 实现 CAP 契约验证器 | ⏳ 待开始 | - | - | - |
| CAP-006 | 实现 CAP 版本管理器 | ⏳ 待开始 | - | - | - |
| CAP-007 | 集成到 CapabilityCenter | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.sdk.cap.*` 包
- CAP 注册表 API 文档
- 单元测试覆盖率 ≥ 80%

---

#### 模块 B：SceneAgent 实现

**负责人**：`@待分配`  
**工作量**：9人天  
**优先级**：P0

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| AGENT-001 | 扩展 Agent 接口，增加 SceneAgent 特有属性 | ⏳ 待开始 | - | - | - |
| AGENT-002 | 实现 SceneAgentImpl | ⏳ 待开始 | - | - | - |
| AGENT-003 | 实现 Agent 状态流转（INITIALIZING→ACTIVE→SUSPENDED→STOPPED） | ⏳ 待开始 | - | - | - |
| AGENT-004 | 实现 Agent 类型（PRIMARY/BACKUP/COLLABORATIVE） | ⏳ 待开始 | - | - | - |
| AGENT-005 | 实现 SceneGroup 故障切换 | ⏳ 待开始 | - | - | - |
| AGENT-006 | 集成到 AgentFactory | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.sdk.api.agent.SceneAgent` 接口
- `net.ooder.sdk.core.agent.impl.SceneAgentImpl` 实现
- Agent 状态流转图文档

---

#### 模块 C：WorkerAgent 实现

**负责人**：`@待分配`  
**工作量**：7人天  
**优先级**：P0

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| WORKER-001 | 定义 WorkerAgent 接口 | ⏳ 待开始 | - | - | - |
| WORKER-002 | 实现 WorkerAgentImpl（封装 Skill + CapProvider） | ⏳ 待开始 | - | - | - |
| WORKER-003 | 实现设备选择策略 | ⏳ 待开始 | - | - | - |
| WORKER-004 | 实现任务执行和状态管理 | ⏳ 待开始 | - | - | - |
| WORKER-005 | 集成到 SceneAgent | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.sdk.api.agent.WorkerAgent` 接口
- `net.ooder.sdk.core.agent.impl.WorkerAgentImpl` 实现

---

#### 模块 D：Workflow 引擎

**负责人**：`@待分配`  
**工作量**：12人天  
**优先级**：P0

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| WF-001 | 定义 WorkflowDefinition 模型 | ⏳ 待开始 | - | - | - |
| WF-002 | 定义 WorkflowStep 模型 | ⏳ 待开始 | - | - | - |
| WF-003 | 实现 WorkflowEngine 接口 | ⏳ 待开始 | - | - | - |
| WF-004 | 实现步骤依赖解析器 | ⏳ 待开始 | - | - | - |
| WF-005 | 实现顺序执行器 | ⏳ 待开始 | - | - | - |
| WF-006 | 实现并行执行器 | ⏳ 待开始 | - | - | - |
| WF-007 | 实现条件执行器 | ⏳ 待开始 | - | - | - |
| WF-008 | 实现 WorkflowContext | ⏳ 待开始 | - | - | - |
| WF-009 | 集成到 SceneManager | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.sdk.workflow.*` 包
- Workflow 执行流程文档
- 示例场景配置

---

### 阶段二：协议与通信升级（第5-7周）

#### 模块 E：Command 体系

**负责人**：`@待分配`  
**工作量**：7人天  
**优先级**：P1

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| CMD-001 | 定义 Command 模型（标准命令/自定义命令） | ⏳ 待开始 | - | - | - |
| CMD-002 | 实现 CommandBuilder | ⏳ 待开始 | - | - | - |
| CMD-003 | 实现 CommandRouter | ⏳ 待开始 | - | - | - |
| CMD-004 | 实现标准命令处理器 | ⏳ 待开始 | - | - | - |
| CMD-005 | 实现自定义命令处理器 | ⏳ 待开始 | - | - | - |
| CMD-006 | 集成到 CapabilityInvoker | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.sdk.command.*` 包
- Command 规范文档

---

#### 模块 F：设备绑定管理

**负责人**：`@待分配`  
**工作量**：5人天  
**优先级**：P1

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| BIND-001 | 定义 DeviceBinding 模型 | ⏳ 待开始 | - | - | - |
| BIND-002 | 实现 BindingManager 接口 | ⏳ 待开始 | - | - | - |
| BIND-003 | 实现强绑定/弱绑定逻辑 | ⏳ 待开始 | - | - | - |
| BIND-004 | 实现设备更换流程 | ⏳ 待开始 | - | - | - |
| BIND-005 | 集成到 Agent 管理 | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.sdk.binding.*` 包
- 设备绑定流程文档

---

#### 模块 G：心跳与状态管理

**负责人**：`@待分配`  
**工作量**：6人天  
**优先级**：P1

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| HB-001 | 扩展现有心跳机制，支持设备分类 | ⏳ 待开始 | - | - | - |
| HB-002 | 实现设备类型心跳策略 | ⏳ 待开始 | - | - | - |
| HB-003 | 实现状态恢复机制（离线→重新入网） | ⏳ 待开始 | - | - | - |
| HB-004 | 实现故障检测和隔离 | ⏳ 待开始 | - | - | - |
| HB-005 | 集成到 OfflineService | ⏳ 待开始 | - | - | - |

**交付物**：
- 增强的 `OfflineService`
- 心跳策略配置文档

---

#### 模块 H：北向/南向协议分层

**负责人**：`@待分配`  
**工作量**：8人天  
**优先级**：P1

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| PROTO-001 | 定义北向协议接口 | ⏳ 待开始 | - | - | - |
| PROTO-002 | 定义南向协议接口 | ⏳ 待开始 | - | - | - |
| PROTO-003 | 实现北向协议消息处理 | ⏳ 待开始 | - | - | - |
| PROTO-004 | 实现南向协议消息处理 | ⏳ 待开始 | - | - | - |
| PROTO-005 | 实现协议消息编解码 | ⏳ 待开始 | - | - | - |
| PROTO-006 | 集成到现有协议体系 | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.sdk.protocol.northbound.*` 包
- `net.ooder.sdk.protocol.southbound.*` 包
- 协议规范文档

---

### 阶段三：配置与文档（第8周）

#### 模块 I：配置规范升级

**负责人**：`@待分配`  
**工作量**：3.5人天  
**优先级**：P2

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| CFG-001 | 扩展 SDKConfiguration 支持 0.8.0 配置 | ⏳ 待开始 | - | - | - |
| CFG-002 | 实现 scene.yaml 解析器 | ⏳ 待开始 | - | - | - |
| CFG-003 | 实现 skill-manifest.yaml 扩展解析 | ⏳ 待开始 | - | - | - |
| CFG-004 | 更新默认配置文件 | ⏳ 待开始 | - | - | - |

---

#### 模块 J：文档更新

**负责人**：`@待分配`  
**工作量**：3.5人天  
**优先级**：P2

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| DOC-001 | 更新 README.md | ⏳ 待开始 | - | - | - |
| DOC-002 | 编写 SDK_0.8.0_UPGRADE_GUIDE.md | ⏳ 待开始 | - | - | - |
| DOC-003 | 更新架构文档 | ⏳ 待开始 | - | - | - |
| DOC-004 | 编写 API 参考文档 | ⏳ 待开始 | - | - | - |

---

### 阶段四：测试与验证（第9-10周）

#### 模块 K：单元测试

**负责人**：`@待分配`  
**工作量**：8人天  
**优先级**：P0

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| TEST-001 | CAP 注册表单元测试 | ⏳ 待开始 | - | - | - |
| TEST-002 | SceneAgent 单元测试 | ⏳ 待开始 | - | - | - |
| TEST-003 | WorkerAgent 单元测试 | ⏳ 待开始 | - | - | - |
| TEST-004 | Workflow 引擎单元测试 | ⏳ 待开始 | - | - | - |
| TEST-005 | Command 体系单元测试 | ⏳ 待开始 | - | - | - |
| TEST-006 | 设备绑定单元测试 | ⏳ 待开始 | - | - | - |

---

#### 模块 L：集成测试

**负责人**：`@待分配`  
**工作量**：6人天  
**优先级**：P0

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| INT-001 | CAP 契约验证集成测试 | ⏳ 待开始 | - | - | - |
| INT-002 | 场景工作流集成测试 | ⏳ 待开始 | - | - | - |
| INT-003 | 离线模式集成测试 | ⏳ 待开始 | - | - | - |
| INT-004 | 多 Agent 协同测试 | ⏳ 待开始 | - | - | - |

---

## 六、Engine 任务分解

### 阶段一：核心架构升级（第1-4周）

#### 模块 M：SceneEngine 核心实现

**负责人**：`@待分配`  
**工作量**：10人天  
**优先级**：P0

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| ENGINE-001 | 实现 SceneEngine 初始化流程 | ⏳ 待开始 | - | - | - |
| ENGINE-002 | 实现 Skill 挂载机制 | ⏳ 待开始 | - | - | - |
| ENGINE-003 | 实现 CAP 路由管理 | ⏳ 待开始 | - | - | - |
| ENGINE-004 | 实现离线模式支持 | ⏳ 待开始 | - | - | - |
| ENGINE-005 | 实现场景组管理 | ⏳ 待开始 | - | - | - |
| ENGINE-006 | 集成到现有 Engine 体系 | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.scene.engine.*` 包增强
- SceneEngine API 文档

---

#### 模块 N：Provider 接口扩展

**负责人**：`@待分配`  
**工作量**：8人天  
**优先级**：P1

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| PROV-001 | 定义 NetworkConfigProvider 接口 | ⏳ 待开始 | - | - | - |
| PROV-002 | 定义 DeviceManagementProvider 接口 | ⏳ 待开始 | - | - | - |
| PROV-003 | 定义 SecurityConfigProvider 接口 | ⏳ 待开始 | - | - | - |
| PROV-004 | 定义 HealthCheckProvider 接口 | ⏳ 待开始 | - | - | - |
| PROV-005 | 定义 AgentProvider 接口 | ⏳ 待开始 | - | - | - |
| PROV-006 | 定义 SkillShareProvider 接口 | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.scene.provider.*` 包扩展
- Provider 接口规范文档

---

#### 模块 O：Skill Connector 实现

**负责人**：`@待分配`  
**工作量**：8人天  
**优先级**：P1

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| CONN-001 | 实现 HttpSkillConnector | ⏳ 待开始 | - | - | - |
| CONN-002 | 实现 LocalJarSkillConnector | ⏳ 待开始 | - | - | - |
| CONN-003 | 实现 GrpcSkillConnector | ⏳ 待开始 | - | - | - |
| CONN-004 | 实现 WebSocketSkillConnector | ⏳ 待开始 | - | - | - |
| CONN-005 | 实现 UdpSkillConnector | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.scene.connector.*` 包
- Connector 实现文档

---

### 阶段二：测试与验证（第5-6周）

#### 模块 P：Engine 单元测试

**负责人**：`@待分配`  
**工作量**：6人天  
**优先级**：P0

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| ETEST-001 | SceneEngine 单元测试 | ⏳ 待开始 | - | - | - |
| ETEST-002 | Skill Connector 单元测试 | ⏳ 待开始 | - | - | - |
| ETEST-003 | CAP 路由单元测试 | ⏳ 待开始 | - | - | - |
| ETEST-004 | 离线模式单元测试 | ⏳ 待开始 | - | - | - |

---

#### 模块 Q：Engine 集成测试

**负责人**：`@待分配`  
**工作量**：4人天  
**优先级**：P0

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| EINT-001 | Skill 挂载集成测试 | ⏳ 待开始 | - | - | - |
| EINT-002 | Workflow 执行集成测试 | ⏳ 待开始 | - | - | - |
| EINT-003 | Provider 接口集成测试 | ⏳ 待开始 | - | - | - |

---

## 七、里程碑计划

| 里程碑 | 版本 | 目标日期 | 主要内容 | 状态 |
|--------|------|----------|----------|------|
| M1 | 0.8.0-alpha1 | 2026-03-08 | CAP 注册表 + SceneAgent | ⏳ 进行中 |
| M2 | 0.8.0-alpha2 | 2026-03-22 | WorkerAgent + Workflow 引擎 | 🔒 未开始 |
| M3 | 0.8.0-beta1 | 2026-04-05 | Command 体系 + 设备绑定 + Engine 核心 | 🔒 未开始 |
| M4 | 0.8.0-rc1 | 2026-04-19 | 北向/南向协议 + Provider 扩展 + 文档 | 🔒 未开始 |
| M5 | 0.8.0 | 2026-05-03 | 测试完成 + 正式发布 | 🔒 未开始 |

---

# 第三部分：项目管理

## 八、风险与依赖

### 8.1 技术风险

| 风险ID | 风险描述 | 影响 | 概率 | 缓解措施 | 负责人 |
|--------|----------|------|------|----------|--------|
| R001 | CAP 契约验证复杂度高 | 延迟 M1 | 中 | 先实现基础验证，后续迭代增强 | - |
| R002 | Workflow 并行执行器实现复杂 | 延迟 M2 | 中 | 参考成熟框架设计 | - |
| R003 | 离线模式状态同步 | 数据一致性 | 低 | 设计完善的状态机，增加测试覆盖 | - |
| R004 | 多 Agent 协同复杂度 | 延迟测试 | 中 | 提前进行架构评审 | - |
| R005 | SDK 与 Engine 接口协调 | 集成延迟 | 中 | 提前定义接口契约，定期同步 | - |

### 8.2 外部依赖

| 依赖ID | 依赖项 | 说明 | 状态 | 负责人 |
|--------|--------|------|------|--------|
| D001 | skills 仓库 0.8.0 协议文档 | CAP 定义、场景规范 | ✅ 已完成 | - |
| D002 | ooder-common VFS 集成 | 数据中心存储 | ⏳ 待确认 | - |
| D003 | SkillCenter API | 技能发现和安装 | ⏳ 待确认 | - |

---

## 九、沟通与协作

### 9.1 会议安排

| 会议类型 | 频率 | 参与人 | 目的 |
|----------|------|--------|------|
| 每日站会 | 每日 10:00 | 全体成员 | 进度同步、问题暴露 |
| 周例会 | 每周五 15:00 | 全体成员 | 周进度总结、下周计划 |
| 技术评审 | 按需 | 相关开发人员 | 方案评审、技术决策 |
| 里程碑评审 | 里程碑结束时 | 全体成员 + 干系人 | 里程碑验收、下阶段规划 |

### 9.2 沟通渠道

| 渠道 | 用途 | 链接 |
|------|------|------|
| GitHub Issues | 问题跟踪、任务分配 | [Issues](https://github.com/ooderCN/ooder-sdk/issues) |
| GitHub PR | 代码评审 | [Pull Requests](https://github.com/ooderCN/ooder-sdk/pulls) |
| 钉钉群 | 日常沟通 | - |
| Wiki | 文档沉淀 | - |

### 9.3 代码规范

- **分支命名**：`feature/模块名-任务ID`，如 `feature/cap-CAP-001`
- **提交信息**：`[模块名] 任务ID: 描述`，如 `[CAP] CAP-001: 添加 CAP 地址空间枚举`
- **PR 要求**：
  - 关联 Issue
  - 单元测试通过
  - 代码评审通过（至少 1 人）
  - 无 SonarQube 严重问题

---

## 十、进度统计

### 10.1 总体进度

| 指标 | 数值 |
|------|------|
| 总任务数 | 76 |
| 已完成 | 0 |
| 进行中 | 0 |
| 待开始 | 76 |
| 完成率 | 0% |

### 10.2 模块进度

| 模块 | 总任务 | 已完成 | 进度 |
|------|--------|--------|------|
| A: CAP 注册表 | 7 | 0 | 0% |
| B: SceneAgent | 6 | 0 | 0% |
| C: WorkerAgent | 5 | 0 | 0% |
| D: Workflow 引擎 | 9 | 0 | 0% |
| E: Command 体系 | 6 | 0 | 0% |
| F: 设备绑定 | 5 | 0 | 0% |
| G: 心跳管理 | 5 | 0 | 0% |
| H: 北向/南向协议 | 6 | 0 | 0% |
| I: 配置规范 | 4 | 0 | 0% |
| J: 文档更新 | 4 | 0 | 0% |
| K: 单元测试 | 6 | 0 | 0% |
| L: 集成测试 | 4 | 0 | 0% |
| M: SceneEngine 核心 | 6 | 0 | 0% |
| N: Provider 扩展 | 6 | 0 | 0% |
| O: Skill Connector | 5 | 0 | 0% |
| P: Engine 单元测试 | 4 | 0 | 0% |
| Q: Engine 集成测试 | 3 | 0 | 0% |

---

## 十一、变更记录

| 日期 | 版本 | 变更内容 | 变更人 |
|------|------|----------|--------|
| 2026-02-23 | v1.0 | 初始版本，整合 SDK 和 Engine 升级计划 | - |

---

## 十二、附录

### 12.1 相关文档链接

- [架构设计总览](https://github.com/ooderCN/skills/blob/main/docs/v0.8.0/ARCHITECTURE-V0.8.0.md)
- [CAP 注册表规范](https://github.com/ooderCN/skills/blob/main/docs/v0.8.0/CAP-REGISTRY-SPEC.md)
- [场景引擎规范](https://github.com/ooderCN/skills/blob/main/docs/v0.8.0/SCENE-ENGINE-SPEC.md)
- [能力发现协议](https://github.com/ooderCN/skills/blob/main/docs/v0.8.0/CAPABILITY-DISCOVERY-PROTOCOL.md)

### 12.2 技术参考

- [Ooder Agent SDK 仓库](https://github.com/ooderCN/ooder-sdk)
- [Ooder Skills 仓库](https://github.com/ooderCN/skills)
- [Spring Boot 文档](https://docs.spring.io/spring-boot/docs/2.7.0/reference/html/)

---

**最后更新**：2026-02-23
